<html lang="en">
<%- include('../partials/header.ejs') %>
<body>
	<form action="/register" method="POST">
		<%- include('../partials/admin-nav.ejs') %>
		<h2>Signup</h2>
		<label for="name">Name</label>
		<input type="text" name="name" required />
		<label for="email">Email</label>
		<input type="text" name="email" required />
		<div class="email error"></div>
		<label for="password">Password</label>
		<input type="password" name="password" required />
		<div class="password error"></div>
		<label for="role">Role</label>
		<select name="role" required>
			<option value="floor manager">Floor Manager</option>
			<option value="general manager">General Manager</option>
			<option value="owner">Owner</option>
			<option value="cashier">Cashier</option>
		</select><br/>
		<button>Sign up</button>
	</form>
	<%- include('../partials/footer') %>

	<script>
		const form = document.querySelector('form');
		const emailError = document.querySelector('.email.error');
		const passwordError = document.querySelector('.password.error');

		form.addEventListener('submit', async(e) => {
			e.preventDefault();

			//Reset Errors
			emailError.textContent = '';
			passwordError.textContent = '';

			//Get Values
			const name = form.name.value;
			const email = form.email.value;
			const password = form.password.value;
			const role = form.role.value.toLowerCase();

			try{
				const res = await fetch('/register', {
					method: 'POST',
					body: JSON.stringify({ name, email, password, role }),
					headers: { 'Content-Type': 'application/json' }
				});
				const data = await res.json();
				if (data.errors) {
					emailError.textContent = data.errors.email;
					passwordError.textContent = data.errors.password;
				}
				if (data.user) {
					// Redirect to home page
					location.assign('/dashboard');
				}
			}
			catch (err) {
				console.log(err);
			}
		});
	</script>
</body>
</html>